@model List<UserMessage>
@{
    ViewData["Title"] = "Admin Mesaj Sayfası";
    Layout = "~/Views/AdminLayout/Layout.cshtml";
}

<div class="container mt-4">
    <h4 class="mb-3">📩 Mesajlar</h4>


    <div class="mb-3">
        <a href="/Message/Index/0" class="btn btn-secondary btn-sm @(ViewBag.MessageId == 0 ? "active" : "")">
            Tümü (@ViewBag.messageCount)
        </a>

        @if (ViewBag.unreadMessageCount > 0)
        {
            <a href="/Message/Index/1" class="btn btn-warning btn-sm @(ViewBag.MessageId == 1 ? "active" : "")">
                Okunmamış (@ViewBag.unreadMessageCount)
            </a>
        }

        @if (ViewBag.readMessageCount > 0)
        {
            <a href="/Message/Index/2" class="btn btn-success btn-sm @(ViewBag.MessageId == 2 ? "active" : "")">
                Okunan (@ViewBag.readMessageCount)
            </a>
        }
    </div>

   
    @foreach (var item in Model)
    {
        <div class="message-in mb-3 p-3 border rounded @(item.IsRead ? "bg-light" : "bg-warning-subtle")">
            <div class="d-flex align-items-center">
              
                <div class="d-flex align-items-center justify-content-center rounded-circle bg-light"
                     style="width:50px; height:50px;">
                    <i class="fa-solid fa-envelope text-primary" style="font-size:22px;"></i>
                </div>

               
                <div class="flex-grow-1 mx-3">
                    <p class="mb-0">
                        <strong>@item.Name</strong> - @item.Subject
                    </p>
                    <small class="text-muted">
                        @(item.IsRead ? "✅ Okundu" : "📩 Okunmadı")
                    </small>
                </div>

             
                <div class="d-flex flex-column flex-sm-row gap-1">
                    <button class="btn btn-outline-primary btn-sm show-detail" data-id="@item.UserMessageId">
                        Detay
                    </button>

                    <button onclick="deletedMessage(@item.UserMessageId)" class="btn btn-outline-danger btn-sm">
                        Sil
                    </button>

                    @if (item.IsRead)
                    {
                        <a href="/Message/Unread/@item.UserMessageId" class="btn btn-outline-warning btn-sm">
                            Okunmadı Yap
                        </a>
                    }
                    else
                    {
                        <a href="/Message/Read/@item.UserMessageId" class="btn btn-outline-success btn-sm">
                            Okundu Yap
                        </a>
                    }
                </div>
            </div>
        </div>
    }
</div>

<script>
    function deletedMessage(id){
            Swal.fire({
      title: "Silmek istediğinize emin misiniz?",
      text: "Bu işlemi geri alamazsınız!",
      icon: "warning",
      showCancelButton: true,
      confirmButtonColor: "#3085d6",
      cancelButtonColor: "#d33",
      confirmButtonText: "Evet, Sil!",
      cancelButtonText: "İptal"
    }).then((result) => {
      if (result.isConfirmed) {
      window.location.href="/Message/DeleteMessage/"+id;
      }
    });
    }
</script>

<div class="modal fade" id="infoModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-body"></div>
        </div>
    </div>
</div>




